\startenvironment env_markdown

% Load the Markdown module.
\startluacode
local kpse = require("kpse")
kpse.set_program_name("luatex")
\stopluacode

\usemodule[t][markdown]
\setupmarkdown[pipeTables]
% Set options of the Markdown module.
% \setupmarkdown
% [
%     contentBlocks = yes,
%     debugExtensions = yes,
%     definitionLists = yes,
%     fancy_lists = yes,
%     fencedCode = yes,
%     hashEnumerators = yes,
%     inlineNotes = yes,
%     lineBlocks = yes,
%     notes = yes,
%     pipeTables = yes,
%     rawAttribute = yes,
%     smartEllipses = yes,
%     strikethrough = yes,
%     subscripts = yes,
%     superscripts = yes,
%     tableCaptions = yes,
%     taskLists = yes,
%     texMathDollars = yes,
%     texMathDoubleBackslash = yes,
%     texMathSingleBackslash = yes,
%   ]

% Set renderers of the Markdown module.
\definehighlight
  [markdownRendererEmphasis]
  [style=\em]

\definehighlight
  [markdownRendererStrongEmphasis]
  [style=bold]

\definehighlight
  [markdownRendererCodeSpan]
  [style=mono]

\definetyping
  [latex]

\setuptyping
  [latex]
  [option=TEX]

\stopenvironment
